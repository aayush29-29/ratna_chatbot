<!DOCTYPE html>
<html>
<head>
  <title>Sign Up - Ratna Chatbot</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="bg-light d-flex flex-column justify-content-center align-items-center" style="height: 100vh; gap: 1.5rem;">

  <div class="card p-4 shadow-lg" style="width: 100%; max-width: 450px;">
    <h2 class="text-center mb-4">Sign Up</h2>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endwith %}
    <form method="POST" novalidate>
      <div class="mb-3">
        <input type="text" name="username" class="form-control" placeholder="Username" required />
      </div>
      <div class="mb-2 position-relative">
        <input type="password" id="signupPassword" name="password" class="form-control" placeholder="Password" required />
        <button type="button" id="toggleSignupPwd" class="btn btn-sm btn-outline-secondary" style="position:absolute; right:8px; top:50%; transform: translateY(-50%); border: none; background: transparent;" aria-label="Show password">
          <i class="fas fa-eye" style="font-size: 1.2rem; color: #6c757d;"></i>
        </button>
      </div>
      <!-- Password Requirements -->
      <div id="passwordRequirements" class="mb-3" style="display: none; background-color: #f8f9fa; padding: 12px; border-radius: 6px; font-size: 0.875rem;">
        <div class="mb-1" style="font-weight: 600; color: #495057; margin-bottom: 8px;">Password Requirements:</div>
        <div class="password-req-item" id="req-length">
          <i class="fas fa-circle" style="color: #dee2e6; font-size: 0.7rem; margin-right: 8px;"></i>
          <span>At least 8 characters</span>
        </div>
        <div class="password-req-item" id="req-uppercase">
          <i class="fas fa-circle" style="color: #dee2e6; font-size: 0.7rem; margin-right: 8px;"></i>
          <span>At least one uppercase letter (A-Z)</span>
        </div>
        <div class="password-req-item" id="req-digit">
          <i class="fas fa-circle" style="color: #dee2e6; font-size: 0.7rem; margin-right: 8px;"></i>
          <span>At least one digit (0-9)</span>
        </div>
        <div class="password-req-item" id="req-valid-chars">
          <i class="fas fa-circle" style="color: #dee2e6; font-size: 0.7rem; margin-right: 8px;"></i>
          <span>Only letters, numbers, @, and _ allowed</span>
        </div>
      </div>
      <button type="submit" class="btn btn-primary w-100">Sign Up</button>
      <div class="mt-3 text-center">
        <a href="{{ url_for('login') }}">Already have an account? Login</a>
      </div>
    </form>
  </div>

  <!-- Guest access link outside the card -->
  <div class="text-center">
    <a href="{{ url_for('use_guest') }}" class="btn btn-link">
      Use Chatbot without login (Guest)
    </a>
  </div>

  <script>
    (function(){
      const btn = document.getElementById('toggleSignupPwd');
      const input = document.getElementById('signupPassword');
      const requirementsDiv = document.getElementById('passwordRequirements');
      
      // Password validation function
      function validatePassword(password) {
        const hasLength = password.length >= 8;
        const hasUppercase = /[A-Z]/.test(password);
        const hasDigit = /\d/.test(password);
        const hasValidChars = /^[A-Za-z0-9@_]+$/.test(password);
        
        return { hasLength, hasUppercase, hasDigit, hasValidChars };
      }
      
      // Update requirement icons
      function updateRequirements(password) {
        const validation = validatePassword(password);
        const reqItems = {
          'req-length': validation.hasLength,
          'req-uppercase': validation.hasUppercase,
          'req-digit': validation.hasDigit,
          'req-valid-chars': validation.hasValidChars
        };
        
        Object.keys(reqItems).forEach(reqId => {
          const reqItem = document.getElementById(reqId);
          if (reqItem) {
            const icon = reqItem.querySelector('i');
            const span = reqItem.querySelector('span');
            if (reqItems[reqId]) {
              icon.classList.remove('fa-circle');
              icon.classList.add('fa-check-circle');
              icon.style.color = '#28a745';
              if (span) span.style.color = '#28a745';
            } else {
              icon.classList.remove('fa-check-circle');
              icon.classList.add('fa-circle');
              icon.style.color = '#dee2e6';
              if (span) span.style.color = '#6c757d';
            }
          }
        });
      }
      
      // Show/hide requirements on focus/blur
      if (input) {
        input.addEventListener('focus', function() {
          if (requirementsDiv) {
            requirementsDiv.style.display = 'block';
          }
        });
        
        input.addEventListener('input', function() {
          updateRequirements(this.value);
        });
        
        input.addEventListener('blur', function() {
          // Keep requirements visible if password is not empty
          if (this.value.length > 0 && requirementsDiv) {
            requirementsDiv.style.display = 'block';
          } else if (requirementsDiv) {
            requirementsDiv.style.display = 'none';
          }
        });
      }
      
      // Toggle password visibility
      if (btn && input) {
        const icon = btn.querySelector('i');
        btn.addEventListener('click', function(){
          const isPwd = input.getAttribute('type') === 'password';
          input.setAttribute('type', isPwd ? 'text' : 'password');
          if (icon) {
            if (isPwd) {
              icon.classList.remove('fa-eye');
              icon.classList.add('fa-eye-slash');
            } else {
              icon.classList.remove('fa-eye-slash');
              icon.classList.add('fa-eye');
            }
          }
          btn.setAttribute('aria-label', isPwd ? 'Hide password' : 'Show password');
        });
      }
    })();
  </script>
  
  <style>
    .password-req-item {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
      color: #6c757d;
      transition: color 0.2s ease;
    }
    .password-req-item:last-child {
      margin-bottom: 0;
    }
    .password-req-item i {
      transition: all 0.2s ease;
    }
  </style>
</body>
</html>