<!DOCTYPE html>
<html>
<head>
    <title>User Feedbacks</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h2 class="mb-4">üìã User Feedbacks</h2>
        {% if feedback_items and feedback_items|length > 0 %}
            <ul class="list-group" id="feedbackList">
                {% for idx, fb in feedback_items %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span class="feedback-text">{{ fb }}</span>
                        {% if session['username'] %}
                            <button type="button" class="btn btn-danger btn-sm delete-feedback-btn" data-index="{{ idx }}">
                                üóëÔ∏è Delete
                            </button>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
            {% if session['username'] %}
                <button type="button" id="deleteAllBtn" class="btn btn-warning mt-3">üßπ Delete All Feedbacks</button>
            {% endif %}
        {% else %}
            <div class="alert alert-info mt-4">No feedbacks submitted yet.</div>
        {% endif %}
        <a href="{{ url_for('chatbot') }}" class="btn btn-primary mt-4">‚¨ÖÔ∏è Back to Chatbot</a>

        <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Individual delete
            document.querySelectorAll('.delete-feedback-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    if (!confirm('Delete this feedback?')) return;
                    const idx = btn.getAttribute('data-index');
                    fetch('/delete-feedback', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({index: idx})
                    })
                    .then(r => r.json())
                    .then(data => {
                        if (data.status === 'success') {
                            btn.closest('li').remove();
                        } else {
                            alert(data.message || 'Failed to delete.');
                        }
                    });
                });
            });
            // Delete all
            const delAllBtn = document.getElementById('deleteAllBtn');
            if (delAllBtn) {
                delAllBtn.addEventListener('click', function() {
                    if (!confirm('Delete ALL feedbacks? This cannot be undone.')) return;
                    fetch('/delete-all-feedbacks', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'}
                    })
                    .then(r => r.json())
                    .then(data => {
                        if (data.status === 'success') {
                            document.getElementById('feedbackList').innerHTML = '';
                            delAllBtn.remove();
                        } else {
                            alert(data.message || 'Failed to delete all.');
                        }
                    });
                });
            }
        });
        </script>
    </div>
</body>
</html>